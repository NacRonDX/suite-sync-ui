<div class="bookings-container">
  <div class="bookings-header">
    <div class="header-content">
      <div>
        <h1 class="bookings-title">My Bookings</h1>
        <p class="bookings-subtitle">View and manage your room reservations</p>
      </div>
    </div>
  </div>

  <div class="bookings-filters">
    <div class="filter-group">
      <label for="statusFilter">Filter by Status:</label>
      <select
        id="statusFilter"
        [(ngModel)]="selectedStatus"
        (change)="onStatusChange()"
        class="status-select">
        @for (option of statusOptions; track option.value) {
          <option [value]="option.value">{{ option.label }}</option>
        }
      </select>
    </div>
    @if (totalElements > 0) {
      <div class="results-info">
        Showing {{ bookings.length }} of {{ totalElements }} booking{{
          totalElements !== 1 ? 's' : ''
        }}
      </div>
    }
  </div>

  @if (isLoading) {
    <div class="loading-container">
      <div class="spinner-large"></div>
      <p>Loading bookings...</p>
    </div>
  }

  @if (!isLoading && errorMessage) {
    <div class="error-container">
      <svg
        class="icon-error"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      <p class="error-text">{{ errorMessage }}</p>
      <button class="btn-retry" (click)="loadBookings()">Try Again</button>
    </div>
  }

  @if (!isLoading && !errorMessage && bookings.length === 0) {
    <div class="empty-state">
      <svg
        class="icon-empty"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
      <p class="empty-text">No bookings found</p>
      <p class="empty-subtext">Start by browsing available rooms</p>
      <a routerLink="/rooms" class="btn-browse">Browse Rooms</a>
    </div>
  }

  @if (!isLoading && !errorMessage && bookings.length > 0) {
    <div class="bookings-list">
      @for (booking of bookings; track booking.id) {
        <div class="booking-card">
          <div class="booking-header">
            <div class="booking-id">
              <span class="label">Booking #</span>
              <span class="value">{{ booking.id }}</span>
            </div>
            <span
              class="booking-status"
              [ngClass]="getStatusClass(booking.status)">
              {{ getStatusText(booking.status) }}
            </span>
          </div>

          <div class="booking-content">
            <div class="booking-details">
              <div class="detail-section">
                <h3 class="section-title">Room Information</h3>
                <div class="detail-row">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round">
                    <path
                      d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                  </svg>
                  <span class="detail-label">Room ID:</span>
                  <span class="detail-value">{{ booking.roomId }}</span>
                </div>
                <button
                  class="btn-view-room"
                  (click)="viewRoomDetails(booking.roomId)">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round">
                    <path
                      d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                  View Room Details
                </button>
              </div>

              <div class="detail-section">
                <h3 class="section-title">Stay Details</h3>
                <div class="detail-row">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round">
                    <rect
                      x="3"
                      y="4"
                      width="18"
                      height="18"
                      rx="2"
                      ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                  <span class="detail-label">Check-in:</span>
                  <span class="detail-value">{{
                    formatDate(booking.checkInDate)
                  }}</span>
                </div>
                <div class="detail-row">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round">
                    <rect
                      x="3"
                      y="4"
                      width="18"
                      height="18"
                      rx="2"
                      ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                  <span class="detail-label">Check-out:</span>
                  <span class="detail-value">{{
                    formatDate(booking.checkOutDate)
                  }}</span>
                </div>
                <div class="detail-row">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  </svg>
                  <span class="detail-label">Duration:</span>
                  <span class="detail-value"
                    >{{
                      calculateNights(booking.checkInDate, booking.checkOutDate)
                    }}
                    night{{
                      calculateNights(
                        booking.checkInDate,
                        booking.checkOutDate
                      ) !== 1
                        ? 's'
                        : ''
                    }}</span
                  >
                </div>
                <div class="detail-row">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                  </svg>
                  <span class="detail-label">Guests:</span>
                  <span class="detail-value"
                    >{{ booking.numberOfGuests }}
                    {{
                      booking.numberOfGuests === 1 ? 'Guest' : 'Guests'
                    }}</span
                  >
                </div>
              </div>

              @if (booking.specialRequests) {
                <div class="detail-section">
                  <h3 class="section-title">Special Requests</h3>
                  <p class="special-requests">{{ booking.specialRequests }}</p>
                </div>
              }
            </div>

            <div class="booking-summary">
              <div class="summary-item">
                <span class="summary-label">Total Price</span>
                <span class="summary-value">{{
                  formatPrice(booking.totalPrice)
                }}</span>
              </div>
              <div class="summary-meta">
                <div class="meta-item">
                  <span class="meta-label">Booked:</span>
                  <span class="meta-value">{{
                    formatDateTime(booking.createdAt)
                  }}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">Updated:</span>
                  <span class="meta-value">{{
                    formatDateTime(booking.updatedAt)
                  }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      }
    </div>

    @if (totalPages > 1) {
      <div class="pagination">
        <button
          class="pagination-btn"
          (click)="previousPage()"
          [disabled]="currentPage === 0">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
          Previous
        </button>

        <div class="pagination-pages">
          @for (page of visiblePages; track page) {
            <button
              class="pagination-page"
              [class.active]="page === currentPage"
              (click)="goToPage(page)">
              {{ page + 1 }}
            </button>
          }
        </div>

        <button
          class="pagination-btn"
          (click)="nextPage()"
          [disabled]="currentPage === totalPages - 1">
          Next
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
    }
  }
</div>
